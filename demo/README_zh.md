[English](README.md) | [中文](README_zh.md)

# PCILeech 演示程序目录

本目录包含两个 PCILeech FPGA 自定义寄存器系统的演示程序。

### 演示程序说明

#### 1. ACTIVATOR_DEMO - DNA 验证激活器

**用途**: FPGA DNA 硬件身份验证与 TLP 访问控制激活

**功能**:
- 读取 FPGA 硬件 DNA 值（57 位唯一标识）
- 执行 DNA 加密验证流程（自定义 XOR 算法）
- 启用 TLP 访问控制（寄存器 0-23 的访问权限）
- 提供 LeechCore API 封装和工具函数

**运行顺序**: 必须先运行此程序进行 DNA 激活

**查看文档**: [ACTIVATOR_DEMO/README_zh.md](./ACTIVATOR_DEMO/README_zh.md)

---

#### 2. CUSTOMREGS_DEMO - 自定义寄存器演示

**用途**: 演示如何使用 LeechCore API 进行自定义寄存器读写操作

**功能**:
- 演示基础寄存器读写（寄存器 0-23）
- 演示多寄存器独立性验证
- 演示 DNA 验证寄存器访问（寄存器 24-31）
- 完整的错误处理和资源清理示例

**运行顺序**: 在 ACTIVATOR_DEMO 激活成功后运行

**查看文档**: [CUSTOMREGS_DEMO/README_zh.md](./CUSTOMREGS_DEMO/README_zh.md)

---

### 快速开始

#### 步骤 1: DNA 激活（必须先执行）

```bash
cd ACTIVATOR_DEMO/x64/Release/
activator.exe
```

**预期输出**:
```
========================================
  步骤1: 连接 FPGA 设备
========================================
[INFO] 正在初始化 LeechCore...
[PASS] FPGA 设备连接成功

========================================
  步骤2: 读取 FPGA DNA
========================================
[PASS] FPGA DNA = 0x0038842957baa85c

========================================
  步骤3: DNA 验证
========================================
[INFO] 启动验证流程...
[PASS] DNA 验证成功

========================================
  步骤4: 检查 TLP 控制状态
========================================
[PASS] TLP 控制已启用（寄存器 29 = 0x00000001）

========================================
  步骤5: 激活摘要
========================================
FPGA DNA: 0x0038842957baa85c
TLP 状态: 已启用
[SUCCESS] DNA 激活成功！可以进行寄存器操作
```

---

#### 步骤 2: 运行自定义寄存器演示

```bash
cd CUSTOMREGS_DEMO/x64/Release/
demo.exe
```

**预期输出**:
```
====================================================
  PCILeech 自定义寄存器 API 使用标准示例
====================================================

========================================
  步骤1: FPGA DNA 激活
========================================
[PASS] TLP 控制已启用

========================================
  步骤2: 基础寄存器读写
========================================
[INFO] 读取寄存器 0 的初始值...
[INFO] 寄存器 0 = 0x00000000
[INFO] 写入测试值 0x12345678 到寄存器 0...
[PASS] 写入成功
[PASS] 读回值匹配: 0x12345678
[INFO] 寄存器读写功能正常！

... (更多测试步骤输出)

====================================================
  所有演示步骤已完成
====================================================
```

---

### 重要注意事项

#### 必须先执行 DNA 激活

FPGA 固件中的 TLP 访问控制在 DNA 验证成功前处于禁用状态。如果直接运行 CUSTOMREGS_DEMO 而不先激活，访问寄存器 0-23 将返回全 0 或失败。

**正确的使用顺序**:
1. 运行 `ACTIVATOR_DEMO/activator.exe` 进行 DNA 激活
2. 确认 TLP 控制状态为"已启用"
3. 运行 `CUSTOMREGS_DEMO/demo.exe` 进行寄存器操作

#### 寄存器分组说明

- **寄存器 0-23**: 通用自定义寄存器（需 DNA 激活后才可访问）
- **寄存器 24-31**: DNA 验证寄存器（可在激活前读取，但 TLP 功能需激活后才启用）

---

### 开发环境要求

#### 硬件
- PCILeech FPGA 设备（Artix-7 35T/75T/100T）
- USB 3.0 接口（FT601 芯片）
- 目标主机（用于 PCIe 测试）

#### 软件
- Windows 10/11 x64
- Visual Studio 2022（MSVC v143 工具集）
- FTD3XX 驱动已安装

---

### 相关文档

- [PCILeech 架构与通信原理](../PCILeech架构与通信原理.md) - 系统架构与软硬件通信机制详解
- [项目总览](../README.md) - 项目介绍与文档导航

---

**最后更新**: 2025-11-29
